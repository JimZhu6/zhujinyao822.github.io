---
title: "关于跨域"
data: 2018-4-20
categories: "学习笔记类"
copyright: false
---

​	跨域产生的原因：是*浏览器的安全机制*，两个不同域名之间发生请求，**协议名**、**端口**、**ip（域名）**之间任意一项有任何的不同，浏览器即判定为跨域，跨域默认是不允许的。

> 一旦产生跨域问题，浏览器将会报错并提示：**Access-Control-Allow-Origin**

<!--more-->

### 解决方法1——CROS

​	在ajax请求的url对应的服务器（php）设置：header("Access-Control-Allow-Origin:*")。

这里的*号表示这个php文件接受任何其他域名的访问，也可以指定某个域名。

### 解决方法2 ——使用jsonp

> 使用jsonp解决跨域是利用了script标签的src属性具有天然的可跨域特性来实现的。
>
> jsonp是通过script的src来发送的
>
> jsonp只能以get方式发送请求

​	在前端的script标签里请求php文件，返回的结果会默认调用eval函数，将返回的结果放在eval函数里执行。

> eval(*string*)	如果参数是一个表达式，eval() 函数将执行表达式。如果参数是Javascript语句，eval()将执行 Javascript 语句。

```javascript
eval("alert(这是一个提示框)")
```

​	在script的src向后台发送请求，传递一个前台有的函数名到后台，服务器返回这个函数的调用形式（是字符串，返回到前台时通过eval()执行），在这个调用形式里面拼接用户所需要的数据。

```html
<script>
  function test(res) {
    console.log(res);
  }
</script>
<!-- url后面接参数，callback是固定的，=号后面的是要执行的函数名 -->
<script src="http://127.0.0.1/html/day6/index.php?callback=test"></script>
```

```php
//读取json文件，返回字符串
$data =file_get_contents('data.json');
//固定写法：将这个函数当做参数返回给前台的test函数执行
$callback = $_GET['callback'];
echo $callback.'('.$data.')';
```



#### 利用ajax

​	在前端页面的ajax里添加**dataType:'jsonp'**，此时，跨域的错误提示已经不出现了。但是数据还暂时无法获取得到，因为跨域还需要后端的配合。

```javascript
<script>
  $.ajax({
    //不做url传参，后台将随机返回函数名
    url: "http://127.0.0.1/html/day6/index.php",
    type: 'get',
    //固定类型为jsonp
    dataType: 'jsonp',
    success: function (res) {
      console.log(res);
    }
  })
</script>
```

```php
//读取json文件，返回字符串
$data =file_get_contents('data.json');
//固定写法：将这个函数当做参数返回给前台的test函数执行
$callback = $_GET['callback'];
echo $callback.'('.$data.')';
```



扩展阅读：[函数的调用形式](https://blog.csdn.net/qq_16415157/article/details/53033953) 

扩展阅读：[前端常见跨域解决方法](https://www.cnblogs.com/roam/p/7520433.html) 

